<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <title>Th·∫ßm k√≠n</title>
    <link rel="stylesheet" href="style.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
    />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
  </head>
  <body>
    <header>
      <a href="index.html" class="logo">BestFlace</a>

      <div class="menu-icon" aria-label="Open menu" role="button" tabindex="0">
        <i class="fa fa-bars" aria-hidden="true"></i>
      </div>

      <nav>
        <a href="index.html">Gi·ªõi thi·ªáu</a>
        <a href="thamkin.html">Th·∫ßm k√≠n</a>
        <a href="tarot.html">Tarot</a>
        <a href="#">H·ªçc v·∫•n</a>
        <a href="#">Li√™n l·∫°c</a>
      </nav>
    </header>

    <section class="home">
      <div class="home-content">
        <h1>Mu·ªën t√¢m s·ª± th√¨ b·∫•m n√∫t b√™n d∆∞·ªõi nh√© üíô</h1>
        <button type="button" id="openFormBtn" class="btn">T√¢m s·ª±</button>
      </div>
    </section>

    <!-- Modal overlay (hi·ªán l√™n m√†n h√¨nh) -->
    <div id="tarotModal" class="modal" aria-hidden="true">
      <div
        class="modal-dialog"
        role="dialog"
        aria-modal="true"
        aria-labelledby="modalTitle"
      >
        <button class="modal-close" id="modalClose" aria-label="ƒê√≥ng">
          &times;
        </button>
        <h2 id="modalTitle">C√≥ chuy·ªán g√¨ h√¥ng m√° ?</h2>

        <form id="tarotForm" class="secret-form">
          <label for="modal-email">ƒêi·ªÅn mail v√¥</label>
          <input type="email" id="modal-email" name="email" required />

          <label for="modal-message">R√≤i gi·ªù t√¢m s·ª± ƒëi</label>
          <textarea
            id="modal-message"
            name="message"
            rows="6"
            required
          ></textarea>

          <div class="form-actions">
            <button type="button" id="closeFormBtn" class="btn cancel">
              C√∫t
            </button>
            <button type="submit" class="btn">G·ª≠i cho Dƒ©</button>
          </div>
        </form>

        <p id="resMsg" style="color: green; display: none; margin-top: 10px">
          ƒê√£ g·ª≠i th√†nh c√¥ng!
        </p>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const openBtn = document.getElementById("openFormBtn");
        const closeBtn = document.getElementById("closeFormBtn");
        const modalClose = document.getElementById("modalClose");
        const modal = document.getElementById("tarotModal");
        const form = document.getElementById("tarotForm");
        const resMsg = document.getElementById("resMsg");

        function openModal() {
          modal.classList.add("open");
          document.body.style.overflow = "hidden";
          modal.setAttribute("aria-hidden", "false");
          // focus first input
          setTimeout(
            () => document.getElementById("modal-email")?.focus(),
            120
          );
        }

        function closeModal() {
          modal.classList.remove("open");
          document.body.style.overflow = "";
          modal.setAttribute("aria-hidden", "true");
        }

        openBtn?.addEventListener("click", openModal);
        closeBtn?.addEventListener("click", closeModal);
        modalClose?.addEventListener("click", closeModal);

        // click outside dialog to close
        modal?.addEventListener("click", (e) => {
          if (e.target === modal) closeModal();
        });

        // submit via fetch to backend (adjust URL if needed)
        form?.addEventListener("submit", async (e) => {
          e.preventDefault();
          const email = document.getElementById("modal-email").value.trim();
          const message = document.getElementById("modal-message").value.trim();
          if (!email || !message) return;

          try {
            const res = await fetch("/api/send", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ email, message }),
            });
            if (res.ok) {
              resMsg.style.display = "block";
              form.reset();
              setTimeout(() => {
                resMsg.style.display = "none";
                closeModal();
              }, 1700);
            } else {
              alert("G·ª≠i th·∫•t b·∫°i");
            }
          } catch (err) {
            alert("L·ªói k·∫øt n·ªëi t·ªõi server");
            console.error(err);
          }
        });

        // keyboard Esc to close
        document.addEventListener("keydown", (e) => {
          if (e.key === "Escape" && modal.classList.contains("open"))
            closeModal();
        });
      });
    </script>
    <script>
      function toggleMenu() {
        document.querySelector("nav").classList.toggle("active");
      }
    </script>
    <script src="js/menu.js"></script>
  </body>
</html>
